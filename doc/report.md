# 22-23春《数据库原理》课程实验报告

### 元数据模块

1. 数据库的持久化

数据库相关信息由`Manager`类进行管理。`Manager`类在**创建或删除数据库时**向`/data/manager`文件中存储目前服务器中存在的**数据库名称**。并且每次在数据库服务器启动时，从该文件中读取各数据库的名称并保存到其成员变量`HashMap<String, Database>`中，但是**只保留数据库的名称，不初始化数据库类`Database`对象——即上述`HashMap`的`value`** ，供系统根据已有数据库名称进行生成新的数据库、切换数据库、删除数据库的操作。

当用户切换至已有数据库时，才通过`Database`的构造函数初始化相关对象并恢复该数据库的数据。

2. 表的持久化

表相关信息由`Database`类进行管理，存储于`Table`类中。当`Manager`类切换至已有数据库时，调用`Database`类的构造函数以从相关文件——`/data/<databaseName>/meta`中读取该数据库下的表信息。

每当有新的表生成或者表被删除时，向上述`meta`文件写入相关信息，以实现持久化。而与`Manager`类（数据库元数据）不同的是：**用二进制形式写入文件，并用二进制形式读取文件内容以恢复表信息状态**，不仅保留了简单的表名称，还存储了表中各列信息以及供各表中查询的B+树节点。